version: "2"

volumes:
  node_data:
  client_data:

services:
  node:
    image: t3z0s/test:latest
    hostname: tshark
    command: /home/appuser/tests/tools/listen-to-tezos-node.sh
    ports:
    expose:
    volumes:
      - node_data:/var/run/tezos/node
      - client_data:/var/run/tezos/client
    restart: on-failure

  node:
    image: tezos/tezos:v7.3
    hostname: node
#    command: tezos-node --help
#    command: tezos-node --net-addr :19732 mkdir -p .tmp --network carthagenet
#    command: tezos-node --net-addr :19732 --network carthagenet
#    command: mkdir -p .tmp && tezos-node --net-addr :19732 --network carthagenet
    entrypoint: [ "/bin/sh", "-xc", "while [ ! -f /var/run/tezos/node/identity.json ]; do sleep 1; done && \
    /usr/local/bin/entrypoint.sh tezos-node --net-addr :19732 --network carthagenet" ]
    ports:
      - "19732:19732"
    expose:
      - "8732"
    volumes:
      - node_data:/var/run/tezos/node
      - client_data:/var/run/tezos/client
    restart: on-failure
  